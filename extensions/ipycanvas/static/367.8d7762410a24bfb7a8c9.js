(self.webpackChunkipycanvas=self.webpackChunkipycanvas||[]).push([[367],{988:function(e,t){"use strict";var s,i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function r(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))};function n(e,t){switch(t.dtype){case"int8":return new Int8Array(e.buffer);case"uint8":return new Uint8Array(e.buffer);case"int16":return new Int16Array(e.buffer);case"uint16":return new Uint16Array(e.buffer);case"int32":return new Int32Array(e.buffer);case"uint32":return new Uint32Array(e.buffer);case"float32":return new Float32Array(e.buffer);case"float64":return new Float64Array(e.buffer);default:throw"Unknown dtype "+t.dtype}}Object.defineProperty(t,"__esModule",{value:!0}),t.getTypedArray=n,function(e){e.isScalar=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e}}(s||(s={}));class a{}t.Arg=a;class o extends a{constructor(e){super(),this.value=e,this.length=1/0}getItem(e){return this.value}}class r extends a{constructor(e,t){super(),this.value=n(t,e),this.length=this.value.length}getItem(e){return this.value[e]}}function l(e){return i(this,void 0,void 0,(function*(){return new Promise(((t,s)=>{e.toBlob((e=>{if(null==e)return s("Unable to create blob");t(e)}))}))}))}t.getArg=function(e,t){if(s.isScalar(e))return new o(e);if(void 0!==e.idx)return new r(e,t[e.idx]);throw"Could not process argument "+e},t.toBlob=l,t.toBytes=function(e){return i(this,void 0,void 0,(function*(){const t=yield l(e);return new Promise(((e,s)=>{const i=new FileReader;i.onloadend=()=>{if("string"==typeof i.result||null==i.result)return s("Unable to read blob");const t=new Uint8ClampedArray(i.result);e(t)},i.readAsArrayBuffer(t)}))}))},t.fromBytes=function(e){return i(this,void 0,void 0,(function*(){const t=new Blob([e]);return new Promise(((e,s)=>{const i=new Image;i.onload=()=>{e(i)},i.src=URL.createObjectURL(t)}))}))}},657:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=s(306);t.MODULE_VERSION=i.version,t.MODULE_NAME=i.name},367:function(e,t,s){"use strict";var i=this&&this.__awaiter||function(e,t,s,i){return new(s||(s=Promise))((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function r(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const n=s(602),a=s(648),o=s(136),r=s(657),l=s(988);function h(e){const t=e.getContext("2d");if(null===t)throw"Could not create 2d context.";return t}function c(e){return i(this,void 0,void 0,(function*(){let t;const s=e.get("format"),i=e.get("value");if("url"!==s){const e=new Blob([i],{type:`image/${s}`});t=URL.createObjectURL(e)}else t=new TextDecoder("utf-8").decode(i.buffer);const n=new Image;return new Promise((e=>{n.onload=()=>{e(n)},n.src=t}))}))}const d=["fillRect","strokeRect","fillRects","strokeRects","clearRect","fillArc","fillCircle","strokeArc","strokeCircle","fillArcs","strokeArcs","fillCircles","strokeCircles","strokeLine","beginPath","closePath","stroke","fillPath","fill","moveTo","lineTo","rect","arc","ellipse","arcTo","quadraticCurveTo","bezierCurveTo","fillText","strokeText","setLineDash","drawImage","putImageData","clip","save","restore","translate","rotate","scale","transform","setTransform","resetTransform","set","clear","sleep","fillPolygon","strokePolygon","strokeLines","fillPolygons","strokePolygons","strokeLineSegments","fillStyledRects","strokeStyledRects","fillStyledCircles","strokeStyledCircles","fillStyledArcs","strokeStyledArcs","fillStyledPolygons","strokeStyledPolygons","strokeStyledLineSegments"];class g extends a.WidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:g.model_name,_model_module:g.model_module,_model_module_version:g.model_module_version,value:""})}initialize(e,t){super.initialize(e,t),this.value=new Path2D(this.get("value"))}}t.Path2DModel=g,g.model_name="Path2DModel",g.model_module=r.MODULE_NAME,g.model_module_version=r.MODULE_VERSION;class u extends a.WidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:u.model_name,_model_module:u.model_module,_model_module_version:u.model_module_version,image:"",repetition:"repeat"})}initialize(e,t){const s=Object.create(null,{initialize:{get:()=>super.initialize}});return i(this,void 0,void 0,(function*(){s.initialize.call(this,e,t);const i=this.get("image");let n;if((i instanceof y||i instanceof w)&&(n=i.canvas),"ImageModel"==i.get("_model_name")&&(n=yield c(i)),null==n)throw"Could not understand the souce for the pattern";const a=u.ctx.createPattern(n,this.get("repetition"));if(null==a)throw"Could not initialize pattern object";this.value=a}))}}t.PatternModel=u,u.serializers=Object.assign(Object.assign({},a.WidgetModel.serializers),{image:{deserialize:a.unpack_models}}),u.model_name="PatternModel",u.model_module=r.MODULE_NAME,u.model_module_version=r.MODULE_VERSION,u.ctx=h(document.createElement("canvas"));class m extends a.WidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_module:m.model_module,_model_module_version:m.model_module_version,x0:0,y0:0,x1:0,y1:0,color_stops:[]})}initialize(e,t){super.initialize(e,t),this.createGradient();for(const e of this.get("color_stops"))this.value.addColorStop(e[0],e[1])}createGradient(){this.value=m.ctx.createLinearGradient(this.get("x0"),this.get("y0"),this.get("x1"),this.get("y1"))}}m.model_module=r.MODULE_NAME,m.model_module_version=r.MODULE_VERSION,m.ctx=h(document.createElement("canvas"));class f extends m{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:f.model_name})}}t.LinearGradientModel=f,f.model_name="LinearGradientModel";class v extends m{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:v.model_name,r0:0,r1:0})}createGradient(){this.value=m.ctx.createRadialGradient(this.get("x0"),this.get("y0"),this.get("r0"),this.get("x1"),this.get("y1"),this.get("r1"))}}t.RadialGradientModel=v,v.model_name="RadialGradientModel";class y extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:y.model_name,_model_module:y.model_module,_model_module_version:y.model_module_version,_view_name:y.view_name,_view_module:y.view_module,_view_module_version:y.view_module_version,width:700,height:500,sync_image_data:!1,image_data:null,_send_client_ready_event:!0})}initialize(e,t){super.initialize(e,t),this.canvas=document.createElement("canvas"),this.ctx=h(this.canvas),this.resizeCanvas(),this.drawImageData(),this.on_some_change(["width","height"],this.resizeCanvas,this),this.on("change:sync_image_data",this.syncImageData.bind(this)),this.on("msg:custom",this.onCommand.bind(this)),this.get("_send_client_ready_event")&&this.send({event:"client_ready"},{})}drawImageData(){return i(this,void 0,void 0,(function*(){if(null!==this.get("image_data")){const e=yield l.fromBytes(this.get("image_data"));this.ctx.drawImage(e,0,0),this.trigger("new-frame")}}))}onCommand(e,t){return i(this,void 0,void 0,(function*(){const s=JSON.parse(n.Buffer.from(l.getTypedArray(t[0],e)).toString("utf-8"));yield this.processCommand(s,t.slice(1,t.length)),this.forEachView((e=>{e.updateCanvas()})),this.trigger("new-frame"),this.syncImageData()}))}processCommand(e,t){return i(this,void 0,void 0,(function*(){if(e instanceof Array&&e[0]instanceof Array){let s=t;for(const t of e){let e=[];const i=t[2];i&&(e=s.slice(0,i),s=s.slice(i)),yield this.processCommand(t,e)}return}const s=d[e[0]],i=e[1];switch(s){case"sleep":yield this.sleep(i[0]);break;case"fillRect":this.fillRect(i[0],i[1],i[2],i[3]);break;case"strokeRect":this.strokeRect(i[0],i[1],i[2],i[3]);break;case"fillRects":this.drawRects(i,t,this.fillRect.bind(this));break;case"strokeRects":this.drawRects(i,t,this.strokeRect.bind(this));break;case"fillArc":this.fillArc(i[0],i[1],i[2],i[3],i[4],i[5]);break;case"strokeArc":this.strokeArc(i[0],i[1],i[2],i[3],i[4],i[5]);break;case"fillArcs":this.drawArcs(i,t,this.fillArc.bind(this));break;case"strokeArcs":this.drawArcs(i,t,this.strokeArc.bind(this));break;case"fillCircle":this.fillCircle(i[0],i[1],i[2]);break;case"strokeCircle":this.strokeCircle(i[0],i[1],i[2]);break;case"fillCircles":this.drawCircles(i,t,this.fillCircle.bind(this));break;case"strokeCircles":this.drawCircles(i,t,this.strokeCircle.bind(this));break;case"strokeLine":this.strokeLine(i,t);break;case"strokeLines":this.strokeLines(i,t);break;case"fillPolygon":this.fillPolygon(i,t);break;case"strokePolygon":this.strokePolygon(i,t);break;case"fillPath":yield this.fillPath(i,t);break;case"drawImage":yield this.drawImage(i,t);break;case"putImageData":this.putImageData(i,t);break;case"set":yield this.setAttr(i[0],i[1]);break;case"clear":this.clearCanvas();break;case"fillPolygons":yield this.drawPolygonOrLineSegments(i,t,!0,!0);break;case"strokePolygons":yield this.drawPolygonOrLineSegments(i,t,!1,!0);break;case"strokeLineSegments":yield this.drawPolygonOrLineSegments(i,t,!1,!1);break;case"fillStyledRects":yield this.drawStyledRects(i,t,!0);break;case"strokeStyledRects":yield this.drawStyledRects(i,t,!1);break;case"fillStyledCircles":yield this.drawStyledCircles(i,t,!0);break;case"strokeStyledCircles":yield this.drawStyledCircles(i,t,!1);break;case"fillStyledArcs":yield this.drawStyledArcs(i,t,!0);break;case"strokeStyledArcs":yield this.drawStyledArcs(i,t,!1);break;case"fillStyledPolygons":yield this.drawStyledPolygonOrLineSegments(i,t,!0,!0);break;case"strokeStyledPolygons":yield this.drawStyledPolygonOrLineSegments(i,t,!1,!0);break;case"strokeStyledLineSegments":yield this.drawStyledPolygonOrLineSegments(i,t,!1,!1);break;default:this.executeCommand(s,i)}}))}sleep(e){return i(this,void 0,void 0,(function*(){this.forEachView((e=>{e.updateCanvas()})),this.trigger("new-frame"),this.syncImageData(),yield new Promise((t=>setTimeout(t,e)))}))}fillRect(e,t,s,i){this.ctx.fillRect(e,t,s,i)}strokeRect(e,t,s,i){this.ctx.strokeRect(e,t,s,i)}drawRects(e,t,s){const i=l.getArg(e[0],t),n=l.getArg(e[1],t),a=l.getArg(e[2],t),o=l.getArg(e[3],t),r=Math.min(i.length,n.length,a.length,o.length);for(let e=0;e<r;++e)s(i.getItem(e),n.getItem(e),a.getItem(e),o.getItem(e))}drawStyledRects(e,t,s){const i=l.getArg(e[0],t),n=l.getArg(e[1],t),a=l.getArg(e[2],t),o=l.getArg(e[3],t),r=l.getArg(e[4],t),h=l.getArg(e[5],t),c=Math.min(i.length,n.length,a.length,o.length);this.ctx.save();for(let e=0;e<c;++e){const t=3*e,l=`rgba(${r.getItem(t)}, ${r.getItem(t+1)}, ${r.getItem(t+2)}, ${h.getItem(e)})`;this.setStyle(l,s),s?this.fillRect(i.getItem(e),n.getItem(e),a.getItem(e),o.getItem(e)):this.strokeRect(i.getItem(e),n.getItem(e),a.getItem(e),o.getItem(e))}this.ctx.restore()}fillArc(e,t,s,i,n,a){this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(e+s*Math.cos(i),t+s*Math.sin(i)),this.ctx.arc(e,t,s,i,n,a),this.ctx.lineTo(e,t),this.ctx.fill(),this.ctx.closePath()}strokeArc(e,t,s,i,n,a){this.ctx.beginPath(),this.ctx.arc(e,t,s,i,n,a),this.ctx.stroke(),this.ctx.closePath()}drawArcs(e,t,s){const i=l.getArg(e[0],t),n=l.getArg(e[1],t),a=l.getArg(e[2],t),o=l.getArg(e[3],t),r=l.getArg(e[4],t),h=l.getArg(e[5],t),c=Math.min(i.length,n.length,a.length,o.length,r.length);for(let e=0;e<c;++e)s(i.getItem(e),n.getItem(e),a.getItem(e),o.getItem(e),r.getItem(e),h.getItem(e))}fillCircle(e,t,s){this.ctx.beginPath(),this.ctx.arc(e,t,s,0,2*Math.PI),this.ctx.fill(),this.ctx.closePath()}strokeCircle(e,t,s){this.ctx.beginPath(),this.ctx.arc(e,t,s,0,2*Math.PI),this.ctx.stroke(),this.ctx.closePath()}drawCircles(e,t,s){const i=l.getArg(e[0],t),n=l.getArg(e[1],t),a=l.getArg(e[2],t),o=Math.min(i.length,n.length,a.length);for(let e=0;e<o;++e)s(i.getItem(e),n.getItem(e),a.getItem(e))}setStyle(e,t){t?this.ctx.fillStyle=e:this.ctx.strokeStyle=e}drawStyledCircles(e,t,s){const i=l.getArg(e[0],t),n=l.getArg(e[1],t),a=l.getArg(e[2],t),o=l.getArg(e[3],t),r=l.getArg(e[4],t),h=Math.min(i.length,n.length,a.length);this.ctx.save();for(let e=0;e<h;++e){const t=3*e,l=`rgba(${o.getItem(t)}, ${o.getItem(t+1)}, ${o.getItem(t+2)}, ${r.getItem(e)})`;this.setStyle(l,s),s?this.fillCircle(i.getItem(e),n.getItem(e),a.getItem(e)):this.strokeCircle(i.getItem(e),n.getItem(e),a.getItem(e))}this.ctx.restore()}drawStyledArcs(e,t,s){const i=l.getArg(e[0],t),n=l.getArg(e[1],t),a=l.getArg(e[2],t),o=l.getArg(e[3],t),r=l.getArg(e[4],t),h=l.getArg(e[5],t),c=l.getArg(e[6],t),d=l.getArg(e[7],t),g=Math.min(i.length,n.length,a.length,o.length,r.length);this.ctx.save();for(let e=0;e<g;++e){const t=3*e,l=`rgba(${c.getItem(t)}, ${c.getItem(t+1)}, ${c.getItem(t+2)}, ${d.getItem(e)})`;this.setStyle(l,s),s?this.fillArc(i.getItem(e),n.getItem(e),a.getItem(e),o.getItem(e),r.getItem(e),h.getItem(e)):this.strokeArc(i.getItem(e),n.getItem(e),a.getItem(e),o.getItem(e),r.getItem(e),h.getItem(e))}this.ctx.restore()}drawStyledPolygonOrLineSegments(e,t,s,i){const n=e[0],a=l.getArg(e[1],t),o=l.getArg(e[2],t),r=l.getArg(e[3],t),h=l.getArg(e[4],t);this.ctx.save();var c=0;for(let e=0;e<n;++e){const t=3*e,n=`rgba(${r.getItem(t)}, ${r.getItem(t+1)}, ${r.getItem(t+2)}, ${h.getItem(e)})`;this.setStyle(n,s);const l=c+2*o.getItem(e);this.ctx.beginPath(),this.ctx.moveTo(a.getItem(c),a.getItem(c+1));for(let e=c+2;e<l;e+=2)this.ctx.lineTo(a.getItem(e),a.getItem(e+1));c=l,i&&this.ctx.closePath(),s?this.ctx.fill():this.ctx.stroke()}this.ctx.restore()}drawPolygonOrLineSegments(e,t,s,i){const n=e[0],a=l.getArg(e[1],t),o=l.getArg(e[2],t);var r=0;for(let e=0;e<n;++e){const t=r+2*o.getItem(e);this.ctx.beginPath(),this.ctx.moveTo(a.getItem(r),a.getItem(r+1));for(let e=r+2;e<t;e+=2)this.ctx.lineTo(a.getItem(e),a.getItem(e+1));r=t,i&&this.ctx.closePath(),s?this.ctx.fill():this.ctx.stroke()}}strokeLine(e,t){this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(e[2],e[3]),this.ctx.stroke(),this.ctx.closePath()}strokeLines(e,t){this.ctx.beginPath();const s=l.getArg(e[0],t);this.ctx.moveTo(s.getItem(0),s.getItem(1));for(let e=2;e<s.length;e+=2)this.ctx.lineTo(s.getItem(e),s.getItem(e+1));this.ctx.stroke(),this.ctx.closePath()}fillPolygon(e,t){this.ctx.beginPath();const s=l.getArg(e[0],t);this.ctx.moveTo(s.getItem(0),s.getItem(1));for(let e=2;e<s.length;e+=2)this.ctx.lineTo(s.getItem(e),s.getItem(e+1));this.ctx.closePath(),this.ctx.fill()}strokePolygon(e,t){this.ctx.beginPath();const s=l.getArg(e[0],t);this.ctx.moveTo(s.getItem(0),s.getItem(1));for(let e=2;e<s.length;e+=2)this.ctx.lineTo(s.getItem(e),s.getItem(e+1));this.ctx.closePath(),this.ctx.stroke()}fillPath(e,t){return i(this,void 0,void 0,(function*(){const[t]=e,s=yield a.unpack_models(t,this.widget_manager);this.ctx.fill(s.value)}))}drawImage(e,t){return i(this,void 0,void 0,(function*(){const[t,s,i,n,o]=e,r=yield a.unpack_models(t,this.widget_manager);if(r instanceof y||r instanceof w)this._drawImage(r.canvas,s,i,n,o);else if("ImageModel"==r.get("_model_name")){const e=yield c(r);this._drawImage(e,s,i,n,o)}}))}_drawImage(e,t,s,i,n){void 0===i||void 0===n?this.ctx.drawImage(e,t,s):this.ctx.drawImage(e,t,s,i,n)}putImageData(e,t){const[s,i,n]=e,a=s.shape[1],o=s.shape[0],r=new Uint8ClampedArray(t[0].buffer),l=new ImageData(r,a,o),c=document.createElement("canvas");c.width=a,c.height=o,h(c).putImageData(l,0,0),this.ctx.drawImage(c,i,n)}setAttr(e,t){return i(this,void 0,void 0,(function*(){if("string"==typeof t&&t.startsWith("IPY")){const e=yield a.unpack_models(t,this.widget_manager);t=e.value}this.ctx[y.ATTRS[e]]=t}))}clearCanvas(){this.forEachView((e=>{e.clear()})),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}executeCommand(e,t=[]){this.ctx[e](...t)}forEachView(e){for(const t in this.views)this.views[t].then((t=>{e(t)}))}resizeCanvas(){this.canvas.setAttribute("width",this.get("width")),this.canvas.setAttribute("height",this.get("height"))}syncImageData(){return i(this,void 0,void 0,(function*(){if(!this.get("sync_image_data"))return;const e=yield l.toBytes(this.canvas);this.set("image_data",e),this.save_changes()}))}}t.CanvasModel=y,y.serializers=Object.assign(Object.assign({},a.DOMWidgetModel.serializers),{image_data:{serialize:function(e){return new DataView(e.buffer.slice(0))},deserialize:function(e){return null===e?null:new Uint8ClampedArray(e.buffer)}}}),y.ATTRS=["fillStyle","strokeStyle","globalAlpha","font","textAlign","textBaseline","direction","globalCompositeOperation","lineWidth","lineCap","lineJoin","miterLimit","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","filter"],y.model_name="CanvasModel",y.model_module=r.MODULE_NAME,y.model_module_version=r.MODULE_VERSION,y.view_name="CanvasView",y.view_module=r.MODULE_NAME,y.view_module_version=r.MODULE_VERSION;class _ extends y{constructor(){super(...arguments),this.roughFillStyle="hachure",this.roughness=1,this.bowing=1}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:_.model_name})}initialize(e,t){super.initialize(e,t),this.roughCanvas=new o.RoughCanvas(this.canvas)}fillRect(e,t,s,i){this.roughCanvas.rectangle(e,t,s,i,this.getRoughFillStyle())}strokeRect(e,t,s,i){this.roughCanvas.rectangle(e,t,s,i,this.getRoughStrokeStyle())}fillCircle(e,t,s){this.roughCanvas.circle(e,t,2*s,this.getRoughFillStyle())}strokeCircle(e,t,s){this.roughCanvas.circle(e,t,2*s,this.getRoughStrokeStyle())}strokeLine(e,t){this.roughCanvas.line(e[0],e[1],e[2],e[3],this.getRoughStrokeStyle())}strokeLines(e,t){const s=l.getArg(e[0],t),i=[];for(let e=0;e<s.length;e+=2)i.push([s.getItem(e),s.getItem(e+1)]);this.roughCanvas.linearPath(i,this.getRoughStrokeStyle())}fillPath(e,t){return i(this,void 0,void 0,(function*(){const[t]=e,s=yield a.unpack_models(t,this.widget_manager);this.roughCanvas.path(s.get("value"),this.getRoughFillStyle())}))}fillArc(e,t,s,i,n,a){const o=2*s,r=a?n:i,l=a?i+2*Math.PI:n;this.roughCanvas.arc(e,t,o,o,r,l,!0,this.getRoughFillStyle())}strokeArc(e,t,s,i,n,a){const o=2*s,r=a?n:i,l=a?i+2*Math.PI:n;this.roughCanvas.arc(e,t,o,o,r,l,!1,this.getRoughStrokeStyle())}fillPolygon(e,t){const s=l.getArg(e[0],t),i=[];for(let e=0;e<s.length;e+=2)i.push([s.getItem(e),s.getItem(e+1)]);this.roughCanvas.polygon(i,this.getRoughFillStyle())}strokePolygon(e,t){const s=l.getArg(e[0],t),i=[];for(let e=0;e<s.length;e+=2)i.push([s.getItem(e),s.getItem(e+1)]);this.roughCanvas.polygon(i,this.getRoughStrokeStyle())}setAttr(e,t){const s=Object.create(null,{setAttr:{get:()=>super.setAttr}});return i(this,void 0,void 0,(function*(){_.ROUGH_ATTRS[e]?this[_.ROUGH_ATTRS[e]]=t:yield s.setAttr.call(this,e,t)}))}getRoughFillStyle(){const e=this.ctx.fillStyle,t=this.ctx.lineWidth;return{fill:e,fillStyle:this.roughFillStyle,fillWeight:t/2,hachureGap:4*t,curveStepCount:18,strokeWidth:.001,roughness:this.roughness,bowing:this.bowing}}getRoughStrokeStyle(){return{stroke:this.ctx.strokeStyle,strokeWidth:this.ctx.lineWidth,roughness:this.roughness,bowing:this.bowing,curveStepCount:18}}}t.RoughCanvasModel=_,_.ROUGH_ATTRS=new Array(100).concat(["roughFillStyle","roughness","bowing"]),_.model_name="RoughCanvasModel";class b extends a.DOMWidgetView{render(){this.ctx=h(this.el),this.resizeCanvas(),this.model.on_some_change(["width","height"],this.resizeCanvas,this),this.el.addEventListener("mousemove",{handleEvent:this.onMouseMove.bind(this)}),this.el.addEventListener("mousedown",{handleEvent:this.onMouseDown.bind(this)}),this.el.addEventListener("mouseup",{handleEvent:this.onMouseUp.bind(this)}),this.el.addEventListener("mouseout",{handleEvent:this.onMouseOut.bind(this)}),this.el.addEventListener("touchstart",{handleEvent:this.onTouchStart.bind(this)}),this.el.addEventListener("touchend",{handleEvent:this.onTouchEnd.bind(this)}),this.el.addEventListener("touchmove",{handleEvent:this.onTouchMove.bind(this)}),this.el.addEventListener("touchcancel",{handleEvent:this.onTouchCancel.bind(this)}),this.el.addEventListener("keydown",{handleEvent:this.onKeyDown.bind(this)}),this.el.setAttribute("tabindex","0"),this.updateCanvas()}clear(){this.ctx.clearRect(0,0,this.el.width,this.el.height)}updateCanvas(){this.clear(),this.ctx.drawImage(this.model.canvas,0,0)}resizeCanvas(){this.el.setAttribute("width",this.model.get("width")),this.el.setAttribute("height",this.model.get("height"))}onMouseMove(e){this.model.send(Object.assign({event:"mouse_move"},this.getCoordinates(e)),{})}onMouseDown(e){this.el.focus(),this.model.send(Object.assign({event:"mouse_down"},this.getCoordinates(e)),{})}onMouseUp(e){this.model.send(Object.assign({event:"mouse_up"},this.getCoordinates(e)),{})}onMouseOut(e){this.model.send(Object.assign({event:"mouse_out"},this.getCoordinates(e)),{})}onTouchStart(e){const t=Array.from(e.touches);this.model.send({event:"touch_start",touches:t.map(this.getCoordinates.bind(this))},{})}onTouchEnd(e){const t=Array.from(e.touches);this.model.send({event:"touch_end",touches:t.map(this.getCoordinates.bind(this))},{})}onTouchMove(e){const t=Array.from(e.touches);this.model.send({event:"touch_move",touches:t.map(this.getCoordinates.bind(this))},{})}onTouchCancel(e){const t=Array.from(e.touches);this.model.send({event:"touch_cancel",touches:t.map(this.getCoordinates.bind(this))},{})}onKeyDown(e){e.preventDefault(),e.stopPropagation(),this.model.send({event:"key_down",key:e.key,shift_key:e.shiftKey,ctrl_key:e.ctrlKey,meta_key:e.metaKey},{})}getCoordinates(e){const t=this.el.getBoundingClientRect();return{x:this.el.width*(e.clientX-t.left)/t.width,y:this.el.height*(e.clientY-t.top)/t.height}}get tagName(){return"canvas"}}t.CanvasView=b;class w extends a.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:w.model_name,_model_module:w.model_module,_model_module_version:w.model_module_version,_view_name:w.view_name,_view_module:w.view_module,_view_module_version:w.view_module_version,_canvases:[],sync_image_data:!1,image_data:null,width:700,height:500})}initialize(e,t){super.initialize(e,t),this.canvas=document.createElement("canvas"),this.ctx=h(this.canvas),this.resizeCanvas(),this.on_some_change(["width","height"],this.resizeCanvas,this),this.on("change:_canvases",this.updateCanvasModels.bind(this)),this.on("change:sync_image_data",this.syncImageData.bind(this)),this.updateCanvasModels()}get canvasModels(){return this.get("_canvases")}updateCanvasModels(){for(const e of this.canvasModels)e.on("new-frame",this.updateCanvas,this);this.updateCanvas()}updateCanvas(){this.ctx.clearRect(0,0,this.get("width"),this.get("height"));for(const e of this.canvasModels)this.ctx.drawImage(e.canvas,0,0);this.forEachView((e=>{e.updateCanvas()})),this.syncImageData()}resizeCanvas(){this.canvas.setAttribute("width",this.get("width")),this.canvas.setAttribute("height",this.get("height"))}syncImageData(){return i(this,void 0,void 0,(function*(){if(!this.get("sync_image_data"))return;const e=yield l.toBytes(this.canvas);this.set("image_data",e),this.save_changes()}))}forEachView(e){for(const t in this.views)this.views[t].then((t=>{e(t)}))}}t.MultiCanvasModel=w,w.serializers=Object.assign(Object.assign({},a.DOMWidgetModel.serializers),{_canvases:{deserialize:a.unpack_models},image_data:{serialize:e=>new DataView(e.buffer.slice(0))}}),w.model_name="MultiCanvasModel",w.model_module=r.MODULE_NAME,w.model_module_version=r.MODULE_VERSION,w.view_name="MultiCanvasView",w.view_module=r.MODULE_NAME,w.view_module_version=r.MODULE_VERSION,t.MultiCanvasView=class extends b{}},306:e=>{"use strict";e.exports=JSON.parse('{"name":"ipycanvas","version":"0.11.0","description":"Interactive widgets library exposing the browser\'s Canvas API","keywords":["jupyter","jupyterlab","jupyterlab-extension","widgets"],"files":["lib/**/*.js","lib/**/*.d.ts","dist/*.js","dist/*.d.ts"],"homepage":"https://github.com/martinRenou/ipycanvas","bugs":{"url":"https://github.com/martinRenou/ipycanvas/issues"},"license":"BSD-3-Clause","author":{"name":"Martin Renou","email":"martin.renou@gmail.com"},"main":"lib/index.js","types":"./lib/index.d.ts","repository":{"type":"git","url":"https://github.com/martinRenou/ipycanvas"},"scripts":{"build":"yarn run build:lib && yarn run build:nbextension && yarn run build:labextension","build:lib":"tsc","build:nbextension":"webpack","build:labextension":"jupyter labextension build .","build:extensions":"yarn run build && yarn run build:labextension","clean":"yarn run clean:lib && yarn run clean:nbextension && yarn run clean:labextension","clean:lib":"rimraf lib","clean:nbextension":"rimraf ipycanvas/nbextension/static/index.js","clean:labextension":"rimraf ipycanvas/labextension","prepack":"yarn run build","watch:lib":"tsc -w","watch:nbextension":"webpack --watch"},"dependencies":{"@jupyter-widgets/base":"^2.0.1 || ^3 || ^4.0.0","buffer":"^4.9.2","lodash":">=4.17.13","roughjs":"^4.3.1"},"devDependencies":{"@jupyterlab/builder":"^3.0.0","@phosphor/application":"^1.6.0","@phosphor/widgets":"^1.6.0","@types/node":"^10.11.6","@types/webpack-env":"^1.13.6","acorn":"^6.2.0","expect.js":"^0.3.1","fs-extra":"^7.0.0","mkdirp":"^0.5.1","rimraf":"^2.6.2","source-map-loader":"^0.2.4","ts-loader":"^5.2.1","typescript":"~3.8","webpack":"^5","webpack-cli":"^4"},"jupyterlab":{"extension":"lib/plugin","webpackConfig":"webpack.lab.config.js","outputDir":"ipycanvas/labextension","sharedPackages":{"@jupyter-widgets/base":{"bundled":false,"singleton":true}}}}')}}]);